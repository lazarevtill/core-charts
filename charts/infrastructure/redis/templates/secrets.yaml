{{- range .Values.environments }}
---
apiVersion: v1
kind: Secret
metadata:
  name: redis-{{ .name }}-secret
  namespace: {{ $.Release.Namespace }}
  labels:
    app: redis
    environment: {{ .name }}
type: Opaque
data:
  REDIS_HOST: {{ printf "%s-redis-master.%s.svc.cluster.local" $.Release.Name $.Release.Namespace | b64enc }}
  REDIS_PORT: {{ "6379" | b64enc }}
  REDIS_PASSWORD: {{ $.Values.redis.auth.password | b64enc }}
  # Connection string format
  REDIS_URL: {{ printf "redis://:%s@%s-redis-master.%s.svc.cluster.local:6379" $.Values.redis.auth.password $.Release.Name $.Release.Namespace | b64enc }}
{{- end }}