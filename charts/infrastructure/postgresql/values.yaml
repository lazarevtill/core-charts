# PostgreSQL configuration with automatic database and user creation
postgresql:
  auth:
    postgresPassword: "postgres123"
    database: "postgres"

  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: "standard"

    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
      limits:
        memory: "512Mi"
        cpu: "500m"

    # Init scripts to create databases and users
    initdb:
      scripts:
        01-init-databases.sql: |
          -- Create databases and users for development environment
          CREATE USER core_user WITH PASSWORD 'core_password_dev';
          CREATE DATABASE core_pipeline_dev OWNER core_user;
          GRANT ALL PRIVILEGES ON DATABASE core_pipeline_dev TO core_user;

          -- Create databases and users for production environment
          CREATE USER core_user_prod WITH PASSWORD 'core_password_prod';
          CREATE DATABASE core_pipeline_prod OWNER core_user_prod;
          GRANT ALL PRIVILEGES ON DATABASE core_pipeline_prod TO core_user_prod;

          -- Create databases and users for staging if needed
          CREATE USER core_user_staging WITH PASSWORD 'core_password_staging';
          CREATE DATABASE core_pipeline_staging OWNER core_user_staging;
          GRANT ALL PRIVILEGES ON DATABASE core_pipeline_staging TO core_user_staging;

  volumePermissions:
    enabled: true

  metrics:
    enabled: true
    serviceMonitor:
      enabled: false

# List of additional databases to create
databases:
  - name: core_pipeline_dev
    user: core_user
    password: core_password_dev
  - name: core_pipeline_prod
    user: core_user_prod
    password: core_password_prod
  - name: core_pipeline_staging
    user: core_user_staging
    password: core_password_staging