# Production Environment Overrides

replicaCount: 2

image:
  pullPolicy: Always

# Database and Redis credentials from prod secrets
externalSecrets:
  # PostgreSQL credentials
  - envName: DB_HOST
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_HOST
  - envName: DB_PORT
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_PORT
  - envName: DB_USERNAME
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_USERNAME
  - envName: DB_PASSWORD
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_PASSWORD
  - envName: DB_DATABASE
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_DATABASE

  # Legacy PostgreSQL vars
  - envName: POSTGRES_HOST
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_HOST
  - envName: POSTGRES_PORT
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_PORT
  - envName: POSTGRES_USER
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_USERNAME
  - envName: POSTGRES_PASSWORD
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_PASSWORD
  - envName: POSTGRES_DB
    secretName: postgres-core-pipeline-prod-secret
    secretKey: DB_DATABASE

  # Redis credentials
  - envName: REDIS_HOST
    secretName: redis-prod-secret
    secretKey: REDIS_HOST
  - envName: REDIS_PORT
    secretName: redis-prod-secret
    secretKey: REDIS_PORT
  - envName: REDIS_PASSWORD
    secretName: redis-prod-secret
    secretKey: REDIS_PASSWORD
  - envName: BULL_REDIS_URL
    secretName: redis-prod-secret
    secretKey: REDIS_URL
  - envName: REDIS_URL
    secretName: redis-prod-secret
    secretKey: REDIS_URL

ingress:
  enabled: true
  hosts:
    - host: core-pipeline.theedgestory.org
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: cloudflare-origin-tls
      hosts:
        - core-pipeline.theedgestory.org

resources:
  requests:
    cpu: 500m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 1Gi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 75

env:
  NODE_ENV: production
  LOG_LEVEL: info
  LOG_PRETTY: "false"
  DB_LOGGING: "false"

  # Kafka
  KAFKA_CLIENT_ID: core-pipeline-prod
  KAFKA_BROKER: infrastructure-kafka.infrastructure.svc.cluster.local:9092
  KAFKA_CONSUMER_GROUP: core-pipeline-prod-group
  KAFKA_BROKERS: infrastructure-kafka.infrastructure.svc.cluster.local:9092
  KAFKA_GROUP_ID: core-pipeline-prod-group

  # Observability
  OTEL_SERVICE_NAME: core-pipeline-prod
