apiVersion: v1
kind: Secret
metadata:
  name: dcmaidbot-secrets
  namespace: {{ .Release.Namespace }}
  labels:
    app: dcmaidbot
    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
    release: {{ .Release.Name }}
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "0"
    "helm.sh/hook-delete-policy": before-hook-creation
type: Opaque
stringData:
  # User-provided secrets (REQUIRED)
  bot-token: {{ .Values.botToken | required "botToken is required!" | quote }}
  admin-ids: {{ .Values.adminIds | required "adminIds is required!" | quote }}

  # Auto-generated connection strings from infrastructure
  database-url: "postgresql://{{ .Values.database.user }}:{{ .Values.database.password }}@{{ .Values.database.host }}:{{ .Values.database.port }}/{{ .Values.database.name }}"
  redis-url: "redis://:{{ .Values.redis.password }}@{{ .Values.redis.host }}:{{ .Values.redis.port }}"

  # Database connection components
  db-host: {{ .Values.database.host | quote }}
  db-port: {{ .Values.database.port | quote }}
  db-name: {{ .Values.database.name | quote }}
  db-user: {{ .Values.database.user | quote }}
  db-password: {{ .Values.database.password | quote }}

  # Optional secrets with defaults
  openai-api-key: {{ .Values.openaiApiKey | default "sk-placeholder-configure-openai-key" | quote }}
  webhook-mode: {{ .Values.webhookMode | default "false" | quote }}
  {{- if .Values.webhookUrl }}
  webhook-url: {{ .Values.webhookUrl | quote }}
  {{- end }}
  {{- if .Values.webhookSecret }}
  webhook-secret: {{ .Values.webhookSecret | quote }}
  {{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: dcmaidbot-nudge-secret
  namespace: {{ .Release.Namespace }}
  labels:
    app: dcmaidbot
    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
    release: {{ .Release.Name }}
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "0"
    "helm.sh/hook-delete-policy": before-hook-creation
type: Opaque
stringData:
  NUDGE_SECRET: {{ .Values.nudgeSecret | default "auto-generated-nudge-secret" | quote }}

