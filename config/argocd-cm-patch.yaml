# ArgoCD ConfigMap Patch
# Apply with: kubectl patch configmap argocd-cm -n argocd --patch-file argocd-cm-patch.yaml

data:
  # External links (pinned to top navigation)
  ui.externalLinks: |
    - title: "ğŸ” Authentik SSO"
      url: "https://auth.theedgestory.org"
    - title: "ğŸ“Š Grafana"
      url: "https://grafana.dev.theedgestory.org"
    - title: "ğŸ“¨ Kafka UI"
      url: "https://kafka.theedgestory.org"
    - title: "ğŸ’¾ MinIO Console"
      url: "https://s3-admin.theedgestory.org"
    - title: "âœ… Status Page"
      url: "https://status.theedgestory.org"
    - title: "ğŸš€ Dev Pipeline"
      url: "https://core-pipeline.dev.theedgestory.org/api-docs"
    - title: "âœ¨ Prod Pipeline"
      url: "https://core-pipeline.theedgestory.org/api-docs"

  # OIDC configuration for Authentik
  url: "https://argo.theedgestory.org"
  oidc.config: |
    name: Authentik
    issuer: https://auth.theedgestory.org/application/o/argocd/
    clientId: argocd
    clientSecret: $oidc.authentik.clientSecret
    requestedScopes: ["openid", "profile", "email", "groups"]
    requestedIDTokenClaims: {"groups": {"essential": true}}

  # RBAC policy - only dcversus@gmail.com has admin access
  policy.csv: |
    p, dcversus@gmail.com, applications, *, */*, allow
    p, dcversus@gmail.com, clusters, *, *, allow
    p, dcversus@gmail.com, repositories, *, *, allow
    p, dcversus@gmail.com, certificates, *, *, allow
    p, dcversus@gmail.com, projects, *, *, allow
    g, dcversus@gmail.com, role:admin

  # Disable built-in admin user
  admin.enabled: "false"