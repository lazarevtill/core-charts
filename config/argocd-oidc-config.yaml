apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: argocd
data:
  # Disable admin user
  admin.enabled: "false"

  # Application URL
  url: "https://argo.theedgestory.org"

  # OIDC configuration for Authentik
  oidc.config: |
    name: Authentik
    issuer: https://auth.theedgestory.org
    clientId: argocd
    clientSecret: $argocd-oidc-secret:clientSecret
    requestedScopes: ["openid", "profile", "email", "groups"]
    requestedIDTokenClaims: {"groups": {"essential": true}}

  # RBAC configuration
  policy.csv: |
    p, role:admin, applications, *, */*, allow
    p, role:admin, clusters, *, *, allow
    p, role:admin, repositories, *, *, allow
    p, role:admin, certificates, *, *, allow
    p, role:admin, projects, *, *, allow
    g, administrators, role:admin
    g, dcversus@gmail.com, role:admin

  policy.default: role:readonly

  # External links
  ui.externalLinks: |
    - title: "ğŸ” Authentik SSO"
      url: "https://auth.theedgestory.org"
    - title: "ğŸ“Š Grafana"
      url: "https://grafana.theedgestory.org"
    - title: "ğŸ“¨ Kafka UI"
      url: "https://kafka.theedgestory.org"
    - title: "ğŸ’¾ MinIO"
      url: "https://s3-admin.theedgestory.org"
    - title: "âœ… Status"
      url: "https://status.theedgestory.org"